---
title: react-testing
date: 2022-07-25 11:07:43
category: react
thumbnail: { thumbnailSrc }
draft: true
---

현재 파이브스팟 모바일 웹을 가꾸어 나가고 있습니다. 빠르게 출시하기 위해
동작하는 프러덕션을 배포하고, 피드백을 취합해서 다음 페이스를 위한 기능적인 살과
뼈대를 붙여나가고 있는 작업이 한창입니다.

![Deliver usable products to allow learning to take place](https://deming.org/wp-content/uploads/2020/06/minimal-viable-product-henrik-kniberg.png)
_[이미지 출처](https://deming.org/minimal-viable-product)_

프러덕션을 가꾸어 나가면서 문뜩 테스트 코드의 필요성을 느끼기 시작했는데요.
단순히 '테스트 코드에 대한 경험이 부족해서..좀 짜봐야 하지 않을 까?' 라는 동기로
구색 갖추기에 급급한 기준 없는 테스트를 하고자 했다면, 오히려 테스트
코드 작성이 작업 진행에 방해가 될 거라는 건 당연했습니다.

그렇기 때문에, 스스로 납득할 수 있고 팀원분들의 공감을 얻을 수 있는 적합한 이유가
등장할 때까지 고민하고 기다렸었는데요. 최근 테스트 코드에 대한 갈증을 느끼면서
그 이유가 허접하지 않기를 바라며 적합한 이유인지 직시하고자 정리해두려 합니다.

_테스트 코드는 필요하다라는 것을 입증하는 좋은 레퍼런스들은 정말 많습니다.
다만, 저가 처해있는 환경에서 테스트 코드는 왜 필요하고, 어떤 역할을 할 수
있을 지에 대한 고민을 담았습니다._

## 왜 테스트 코드가 필요하다고 느꼈을 까

최근 리팩토링, 그리고 V2 API로 마이그레이션하면서 동시에,
새로운 기능을 개발하는 상당히 빠른 변화를 만들어나가고 있습니다.
그 과정에서 가장 큰 걱정거리는 레거시 기능의 히스토리를 찾고, 기능을 유지한채로
내부 코드 품질을 높이는 데 집중해야 한다는 점이었습니다.

사실, 몇몇 히스토리가 분산되어 있어 구두로 공유되거나 코드와 주석을 찾아봐야
알 수 있는 히스토리도 분명 있었기 때문에, 다음 페이스를 위해서라도 기획 관련
히스토리가 그럴싸한 명목하에 작성이 강요되는 구실이 필요했습니다.
그렇지 않으면, 작성과 동시에 레거시가 되는 새로 작성된 코드도 분명
히스토리가 남지 않아 동일한 이슈로 골치 아플겁니다.

### 테스트 코드에 기획 히스토리를 남기자

사실 피그마와 같은 기획 도구들에 얼마든지 쌓아나가면 됩니다. 다만
병렬적으로 코드 레벨에서도 기획 히스토리를 테스트 코드를 통해
기록을 남겨 부수효과를 얻을 수 있겠다 싶었습니다.

가령 깃헙 프로필 UI 기획 명세서가 다음과 같이 작성되어 있다면,
주요 기획내용을 그대로 테스트 describe에 담아낼 수 있습니다.

```text
프로필 섹션은 유저 정보를 확인할 수 있다.
1. 유저의 이름과 아이디를 확인할 수 있다.
2. 유저의 팔로워와 팔로잉 수를 확인할 수 있다.
3. 유저의 소속 회사, 지역, 이메일, 대표 링크를 확인할 수 있다.
...
```

```js
describe("프로필 섹션에서 유저 정보를 확인할 수 있다.", () => {
  it("유저의 이름과 아이디를 확인할 수 있다.", () => { ... });

  it("유저의 팔로워와 팔로잉 수를 확인할 수 있다.", () => { ... });

  it("유저의 소속 회사, 지역, 이메일, 대표 링크를 확인할 수 있다.", () => { ... });
});
```

만약, 기획이 변경된다면 테스트 코드의 설명 또한 변경이 되겠고,
결국 기획 히스토리 또한 수정 사항에 남게 됩니다.

```js
describe("프로필 섹션에서 유저 정보를 확인할 수 있다.", () => {
  it("유저의 이름과 아이디를 확인할 수 있다.", () => { ... });

  //it("유저의 팔로워와 팔로잉 수를 확인할 수 있다.", () => { ... });
  it("유저의 팔로워와 팔로잉 수는 일정 수가 넘으면 '여러 명'으로 표기된다.", () => { ... })

  it("유저의 소속 회사, 지역, 이메일, 대표 링크를 확인할 수 있다.", () => { ... });
});
```

물론, 관점에 따라 test 보다는 spec에 가까운 테스트 코드이지만,
어떤 테스트를 해야할 지 감을 못잡겠다면, 명확한 기획 목적을 테스트 주제로
삼는 것도 좋은 방법입니다.

### 작업자에게 책임을 부여하고 리뷰어의 짐을 덜자

코드 리뷰는 특정 기능 개발을 하는 데 있어 코드 품질을 관리하고,
작업자가 생각하지 못한 설계의 개선점을 언급해주는 용도로서 사용되어야
한다고 생각하는데, 코드 리뷰의 역할이 그 이상 넘어가게 되면 슬슬
리뷰어에게 부담으로 다가오게 됩니다.

가령 특정 기능이 동작하는 지에 대한 QA와 예외적인 상황에 대해 고민하는
시간이 늘어나게 되면 코드 리뷰의 병목을 야기하게 되는데,
이러한 책임을 리뷰어가 담당하게 되면, 리뷰를 받는 작업자는 어쩌면
이후 발생할 수 있는 이슈에 대해 책임을 분할했다는 괘씸한 생각을 할 수도
있습니다.

작업자는 작업에 대한 책임을 온전히 짊어져야 하고, 테스트 코드로서
얼마만큼의 책임을 지고 있는 지에 대해 표현해야 합니다.
여기서 부족한 테스트 케이스에 대해 짚어주는 것 정도가 리뷰어의 역할입니다.

### 안정적인 리팩토링의 잣대

리팩토링하거나, API를 갈아 끼워야 할 때 레거시와 동일한 기능을 유지하기 위해
심혈을 기울입니다. 레거시와 같은 화면을 보여주는 지, 값의 전처리는
잘 이루어지는 지 등에 대한 QA에 많은 시간을 보내곤 하는데요.
그러다보면 레거시가 미워질 때 있고, 히스토리가 명확하지 않아 얄궂게 느껴지기도 합니다.

테스트 코드는 이러한 상황에서 빛을 바랍니다. 여기서 리팩토링을 통해 코드의 퀄리티가
개선되었다는 관점과는 별개로, 테스트 코드는 테스트 타겟의 반환값이 명시한 값과
일치하는 지만을 판단합니다. 때문에 테스트에 성공한다면 타겟 영역의 동작들은
레거시와 동일하다고 판단할 수 있는 지표가 되어 줍니다.

### 코드 분리의 잣대

_테스트 함수마다 한 개념만 테스트하라_

함수는 하나의 일만 담당하고 그 일을 잘하도록 구현해야 한다는 클린 코드의 규칙은
익히 들어왔습니다. 하지만 실상 함수를 작성하다보면, 하나의 일만 담으려 하지만
사이드 이펙트를 온전하게 제거하기란 쉽지 않은데요.

이럴 때 테스트 코드의 describe로 함수의 역할을 구분짓고 함수를 구현하는
TDD 방식으로 작성하면 기준을 명확히 세우는 데 큰 도움이 됩니다.
반대로 함수를 작성하고 테스트 코드를 작성하면 어떻게 테스트해야 할 지 막막해집니다.

## 무슨 테스트를 해야 할 까?
