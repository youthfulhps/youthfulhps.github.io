---
title: 테스트 문서
date: 2019-11-07
description: 테스트문서.
tags:
  - Tutorial
  - Dark Arts
---

본 내용과 관련된 프로젝트는[깃허브 저장소](https://github.com/youthfulhps/react-typescript-openapi-generator)에서 확인할 수 있습니다.

FE CONF2020, '[OpenAPi Specfication으로 타입 세이프하게 API 개발하기](https://www.youtube.com/watch?v=J4JHLESAiFk&t=1471s)'를 보고 OpenAPI Generator 적용기를 정리한 글입니다.

프론트엔드 개발자로서 너무나도 당연하게 백엔드 개발자분들과 의사소통이 필수적이다. 대화 주제는 API 스펙이다. 타 팀들은 어떻게 API 스펙을 공유하고 있을 까?

![Potions Class](./thumbnail.png)

### **API 스펙 공유 방식**

프론트엔드, 백엔드 개발자 간 API 스펙을 공유하기 위한 방법은 다양하다. 그중 대표적인 사례를 살펴보자!

> 구두로 전달한다.

에이, 설마 구두로 주고받는 곳이 아직 있겠어?라고 생각할 수 있다. '우리는 API 스펙을 문서화해서 공유할 거야'라고 킥오프 하지만, 바쁘게 작업하다 보면 API 스펙을 알아보기 위해 문서를 뒤져보기보다는 옆에 있는 백엔드 개발자에게 직접 물어보는 경우가 심심치 않게 있다. 백엔드 개발자가 정확하게 API 스펙을 기억하고 있다면 원하는 스펙 정보를 전달받을 수 있다. 하지만, 대부분의 경우 백엔드 개발자는 API 스펙을 전달하기 위해 코드를 뒤져보거나 나름의 메모를 찾아봐야 하는 경우가 생기게 되니 당연히 휴면 에러와 시간적 소모가 발생한다.

> 공통 편집 문서를 통한 문서화

API 스펙을 문서화하여 공유한다. 도구로는 위키 혹은 구글독스를 사용할 수 있을 것 같다. 하지만, 최신화하기 위해서 손이 많이 갈뿐더러, 휴먼에러가 발생하기 쉽다.

> JSON 형식의 Postman 컬렉션 공유

대부분 API를 작성한 후, API를 테스트하기 위해 [Postman](https://www.postman.com/)과 같은 도구를 사용해본 경험이 있을 것이다. Postman 컬렉션을 공유하는 방법은 확실히 위에 설명한 두 방법보다 실용적인 API 스펙 공유 방법이다. 테스트를 하는 동시에 문서화 작업이 이루어지는 장점이 있지만, '최선일까?'에 대한 근거가 부족하다.

### **OpenAPI Generator?**

단지, 작업하는 데 있어 API 스펙을 찾아보고, 공유하기 위해 시간들여 문서화 작업을 하게 되는 경우가 많다. 개발자라면 작업하기도 바쁜데 문서 최신화까지 하려면 번거롭기 마련이다. 단지, 문서를 API 스펙을 찾아보기 위한 용도로만 사용하는 것이 아니라 부가적인 역할을 담아낼 수는 없을까?

[##_Image|kage@bL4lIE/btq1dAeVQ7o/1UHppEol3kHfOTKsP4jS00/img.jpg|alignCenter|width="500" data-origin-width="420" data-origin-height="318" data-ke-mobilestyle="widthContent"|||_##]

[Openapi-generator](https://openapi-generator.tech/docs/installation)는 열심히 문서화한 API 스펙 파일을 공유받고, 스크립트를 돌리면, API 인터페이스 함수를 담고 있는 클래스와 리턴 타입 객체 인터페이스가 자동으로 생성해준다.

API 스펙 문서를 토대로 클래스와 객체 인터페이스들이 생성해주니 API 스펙 문서의 의존성이 높아지게 되고, 자연스럽게 최신화되어진다. 문서에 존재하는 휴먼에러 또한 코드레벨에서 파악할 수 있게 되니 개발자의 편의가 높아진다.

### **Openapi-Generator, 직접 사용해보자.**

우선, 리엑트 프로젝트를 생성하자.

```
yarn create react-app react-typescript-openapi-generator --template typescript
```

#### **STEP.1 API 스펙을 파일로 공유받고**

API 스펙을 문서화할 때면, 주로 [swagger](https://swagger.io/),[stoplight](https://stoplight.io/) 와 같이 API 스펙 디자인, 문서화를 도와주는 도구들을 많이 사용하는데, 이러한 문서화 도구들의 산출물들은 [YAML](https://ko.wikipedia.org/wiki/YAML) 형식의 직렬화된 마크업 파일이다.

지금 API를 설계하고, 문서화 도구를 통해 API 스펙이 담긴 YAML 파일을 생성할 수가 없으니, 앞서 이 과정을 모두 진행했다 생각하고, [Swagger Editor에](https://editor.swagger.io/) 들어가면 초기값으로 작성되어 있는 문서를 사용해보자.

[##_Image|kage@dp45a8/btq1caVnFfG/kYP23QzjUYdt353Ctv6vsk/img.png|alignCenter|data-filename="스크린샷, 2021-03-28 01-11-31.png" data-origin-width="1825" data-origin-height="959" width="500" data-ke-mobilestyle="widthContent"|||_##]

Swagger Editor는 좌측면이 yaml 형식의 문서를 보기 좋게 문서화하여 우측면처럼 변환해준다. 초기값으로 작성되어 있는 yaml 문서의 모든 내용을 사용하진 않고, 공유된 저장소에 포함되어 있는 yaml 문서는 PET 관련 API만 사용해보기 위해 발췌된 yaml 파일이다.

[##_Image|kage@R1wiI/btq09kd4Oy2/7xPX2TKJUsSaHu4nAbClYK/img.png|alignCenter|data-filename="스크린샷, 2021-03-28 01-26-24.png" data-origin-width="617" data-origin-height="280" width="500" data-ke-mobilestyle="widthContent"|||_##]

#### **STEP.2 스크립트를 돌리면**

우선, [openapi-generator](https://openapi-generator.tech/docs/installation) 패키지를 설치하자.

```js
import Input from "./components/Input";

declare global {
  interface Window {
    ReactInput: any;
  }
}

window.ReactInput = {
  mount: () => {
    const el = document.getElementById("react-app") as HTMLElement;

    const component = <Input />;
    ReactDOM.render(component, el);
  },
  unmount: () => {
    const el = document.getElementById("react-app") as HTMLElement;
    ReactDOM.unmountComponentAtNode(el);
  },
};
```

```
~$ yarn add @openapitools/openapi-generator-cli -g
// ~$ npm install @openapitools/openapi-generator-cli -g
```

openapi-generator는 다양한 환경에서 사용할 수 있도록 여러 [generator](https://openapi-generator.tech/docs/generators)를 제공하고 있다. 그중 리엑트 프로젝트와 잘 어울리고 익숙한 typescript-axios generator를 사용한다.

또한, generator의 config를 설정해줄 수 있는데, 그 내용은 [Config Options for typescript-axios](https://openapi-generator.tech/docs/generators/typescript-axios/)에서 확인가능합니다. 이제 프로젝트에서 config를 설정해주자.

```
//generator.json

{
"npmName": "typescript-axios",
"npmVersion": "1.0.0",
"snapshot": false,
"supportsES6": false,
"modelPropertyNaming": "original"
}
```

이제, openapi-generator 스크립트를 실행시킬 명령어를 나름대로 세팅해보자!

```
~$ openapi-generator-cli generate -i {yaml or json file} -g {generator name} -o {file path to be created} --config {config file}
```

openapi-generator 스크립트를 실행시키기 위해선 위와 같은 구조의 명령어를 터미널에 입력해주면 된다. 현재 다루고 있는 프로젝트에서는 아래와 같은 명령어가 된다.

```
"generator": "openapi-generator-cli generate -i src/lib/specs/pet.yaml -g typescript-axios -o src/lib/apis --config generator.json"
```

package.json, scripts에 추가해놓으면 실행시키기 편하다!

```
"scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject",
    "generator": "openapi-generator-cli generate -i src/lib/specs/pet.yaml -g typescript-axios -o src/lib/apis --config generator.json"
  },
```

```
~$ yarn generator
```

#### **STEP.3 API 인터페이스 함수를 담고 있는 클래스와 리턴 타입 객체 인터페이스가 자동으로 만들어진다면**

[##_Image|kage@cFyOOo/btq1e7xdPiA/01M4NPnGwv8M5kdSpJiE6k/img.png|alignCenter|data-filename="스크린샷, 2021-03-28 13-32-08.png" data-origin-width="604" data-origin-height="411" width="500" data-ke-mobilestyle="widthContent"|||_##]

생성된 파일에는, 인터페이스 함수를 담고 있는 클래스, 관련 객체 인터페이스 등이 자동으로 생성된다. 타입 세이프하게 개발을 하기 위해서 타입 스크립트를 사용하다 보면 api 관련 작업을 할 때 필요한 타이핑양이 상당히 많아지는데, 이러한 골칫거리도 동시에 해결해준다.

### **Stoplight?**

openapi-generator는 API 스펙을 디자인하고, 공유하는 작업에서 직접 번거로울 수 있는 코드까지 생성해준다. 코드 작성에서 소요되는 시간을 비즈니스 로직에 더 집중할 수 있게 도와준다. 이쯤 되면 한 가지 걱정이 드는 것이 있는데 API 스펙을 담은 yaml 파일을 어떻게 하면 더욱 쉽고 직관적으로 작성하고 공유할 수 있을 까?

이럴 때 [Stoplight](https://stoplight.io/)를 사용해보는 것은 어떨까? 자세하게 설명하진 않겠지만 [도큐먼트](https://meta.stoplight.io/docs/platform/2.-workspaces/b.adding-projects.md)를 보면 깃허브와 연동하여 커밋, 브랜치 작업 등 문서 작업을 진행할 수 있다.

실제 API 스펙을 통해 생성된 API를 사용하는 프로젝트에서 API 스펙을 깃허브 서브 모듈로 관리한다면, 최신화된 API 스펙을 더 효율적으로 관리할 수 있다는 장점까지 취할 수 있게 된다.

[##_Image|kage@DemZv/btq1Mriqh5q/dW9EMn1kCmfnod3OsJQSi0/img.png|alignCenter|width="500" data-filename="스크린샷 2021-04-04 오후 10.34.28.png" data-origin-width="772" data-origin-height="572" data-ke-mobilestyle="widthContent"|||_##]

글 도입부에 링크해둔 영상에서도 openapi-generator가 훌륭한 기술임에도 불구하고 유저풀이 좁다라는 언급을 해주셨다. 확실히 괜찮은 레퍼런스를 찾기가 어려워 직접 정리해봤는데, 크게 복잡한 과정이 아니니 꼭 한번 사용해보길 바란다!
