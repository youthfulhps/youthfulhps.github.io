{"componentChunkName":"component---src-templates-blog-post-js","path":"/nextjs/next-isr/","result":{"data":{"site":{"siteMetadata":{"title":"Youthfulhps.dev","description":"프론트엔드 주니어 개발자, 트러블슈팅에 대한 고민의 흔적을 기록으로 남기는 것을 좋아합니다.","author":"youthfulhps","siteUrl":"https://youthfulhps.dev","thumbnail":"/banner.png","comment":{"disqusShortName":"youthfulhps","utterances":"youthfulhps/youthfulhps.github.io"},"sponsor":{"buyMeACoffeeId":"youthfulhps"}}},"markdownRemark":{"id":"39021f2a-3bfa-5388-a29f-8e7145b9490d","excerpt":"…","html":"<blockquote class=\"warning\">작성한 지 2년이 지난 글이에요. 지금과는 맞지 않을 수도 있지만, 당시의 고민과 노력이 담겨있습니다.</blockquote>\n<p>최근 클라이언트 사이드 랜더링 방식을 취하고 있는 프로젝트를 <code class=\"language-text\">next.js</code>로 이관하는 작업이 한창이다. <code class=\"language-text\">next.js</code>는 서버 사이드\n랜더링과 동시에 클라이언트 사이드 랜더링을 동시에 지원하기 때문에, 마이너한 빌드 이슈를 제외하면 점진적 이관이 가능했다.</p>\n<p>이후 페이지별로 적절한 랜더링 전략을 취해야 했다. 가령, 상품 정보와 같은 정적인 정보를 제공하는 페이지의 경우 <code class=\"language-text\">getStaticProps</code>를 통해\n빌드 타임에 패칭된 데이터들을 통해 빠르게 페이지를 제공하고, 동적이고 데이터 정합성을 요구하는 페이지의 경우 <code class=\"language-text\">getServerSideProps</code>를\n통해 제공하는 방식 등을 고려하여 선정해야 했다.</p>\n<p>그러나 동적이지만, 그렇다고 실시간으로 데이터 정합성을 요구하는 정도가 아닌 그 중간 어딘가의 데이터를 사용하는 페이지의 경우,\n최대한 정적 사이트 생성 전략을 통해 해결하려 했다.</p>\n<h2 id=\"ssr-vs-ssg\" style=\"position:relative;\"><a href=\"#ssr-vs-ssg\" aria-label=\"ssr vs ssg permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSR vs SSG</h2>\n<p><code class=\"language-text\">next.js</code>는 서버사이드 랜더링 전략을 쉽게 구현할 수 있도록 두 가지 API를 제공한다. 두 함수의 가장 큰 차이점은 단연\n데이터 패칭의 시점이다. <code class=\"language-text\">getServerSideProps</code>는 클라이언트에서 요청이 들어올 때 외부 데이터를 패칭하여 마크업을 생성하여\n담아낸다.</p>\n<p>반면, <code class=\"language-text\">getStaticProps</code>는 빌드 타임에 마크업 파일을 생성하고, 외부 데이터를 패칭하여 <code class=\"language-text\">json</code> 파일로 작성한다.\n이후 클라이언트의 페이지 요청에 대해 이미 작성되어 있는 마크업 파일과 데이터가 담겨 있는 <code class=\"language-text\">json</code> 파일을 제공한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABX0lEQVR42mWR6Y6CQBCEef/3IPEd/KMxRE28QNAY8EKNuLqGQzzisOwnrWR1O2FSdNdUV/doaZp+FRFFURiG2+32cDjwG8cxpTzPL5fLfr/f7XZUv4tIkoQkJc2yrHq93ul0+v1+r9frdrvtdns4HHKORiMYk8kEguQh27ZtGMZqtXpczt/jp4gS5//iL0HDnud50+lUfN7v9w+SgPP5jGH8A0pdDW948H3fNE1UAIPBQFyJPtM6jhMEget5YABLQUUppc1mM13XK5XKcrmEqrJss9mwPOmPEVkkbBQB0ACcj8sYoLxer9Ur8J9l2ceoJKEdj0d5gqdtvuv1ulgsKKM3n89h0PB2u5WLgXA6nQB05uSpngt7WFUKKin6IyErQIWkkBBlHVTH4zF5MGO/PRXdyDIwKwlDPEaISqnVavHUzWazWq3WarVGo+G67ttl5kyLKBuWgW0ZFUXZkcz8C8mDZ57ZNCHBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"comparison\"\n        title=\"\"\n        src=\"/static/4a557f5896e32c0efefaac19bdc8e343/c1b63/comparison.png\"\n        srcset=\"/static/4a557f5896e32c0efefaac19bdc8e343/5a46d/comparison.png 300w,\n/static/4a557f5896e32c0efefaac19bdc8e343/0a47e/comparison.png 600w,\n/static/4a557f5896e32c0efefaac19bdc8e343/c1b63/comparison.png 1200w,\n/static/4a557f5896e32c0efefaac19bdc8e343/bb543/comparison.png 1418w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"정적-생성-전략을-지향했던-이유\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EC%A0%81-%EC%83%9D%EC%84%B1-%EC%A0%84%EB%9E%B5%EC%9D%84-%EC%A7%80%ED%96%A5%ED%96%88%EB%8D%98-%EC%9D%B4%EC%9C%A0\" aria-label=\"정적 생성 전략을 지향했던 이유 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정적 생성 전략을 지향했던 이유</h3>\n<p>정적 생성된 페이지는 이미 생성된 마크업 파일과 데이터를 소유하고 있기 때문에, 클라이언트의 요청에 서버사이드 랜더링 전략으로\n제공되는 페이지보다 비교적 빠르게 제공된다.\n이는 서버사이드 랜더링 전략 대비 <code class=\"language-text\">Time to First Byte (TTFB)</code>, <code class=\"language-text\">First Input Delay (FID)</code> 등 다양한 웹 성능 메트릭을 개선하는데 큰 이점을 제공한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 725px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.666666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAeUlEQVR42pXKQQ6CMBQAUe5hlFCQNgUL/a0WMEb2kqgx3v8oo55AXbzVTNY6j8TErhMKtSXPKzar8j/rkrYPNE7I0nDkslwZp9M7KHS0yMPj7/13tx55ekzSnLvIMs9ktnHsDyNpmNCmoagrdDDU8pvPq2yN2JbRB16yp1vUlwFTYAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ttfb-ssr\"\n        title=\"\"\n        src=\"/static/b48a30b5a039e12be6c87bd8e1198e25/a0209/ttfb-ssr.png\"\n        srcset=\"/static/b48a30b5a039e12be6c87bd8e1198e25/5a46d/ttfb-ssr.png 300w,\n/static/b48a30b5a039e12be6c87bd8e1198e25/0a47e/ttfb-ssr.png 600w,\n/static/b48a30b5a039e12be6c87bd8e1198e25/a0209/ttfb-ssr.png 725w\"\n        sizes=\"(max-width: 725px) 100vw, 725px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 725px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.666666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhElEQVR42o3O3QqCMABAYd+jH62trWnipqY2EaQIDfoh6P1f5SS9gF18t4cT5GWNKyqUjgkjQbiSrBfif8stYmfIiho5NYJhvNOfrwipiTaS7Gaxr8lzxsPi3g7TH8hNwmcY8TYnqJqWk++wrvwdqmKPrg26mhOjjwrVetI449I0uCTlC6GjXCgPgj6OAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ttfb-ssg\"\n        title=\"\"\n        src=\"/static/7fc71abf4225f99ff2b462510ff84e9b/a0209/ttfb-ssg.png\"\n        srcset=\"/static/7fc71abf4225f99ff2b462510ff84e9b/5a46d/ttfb-ssg.png 300w,\n/static/7fc71abf4225f99ff2b462510ff84e9b/0a47e/ttfb-ssg.png 600w,\n/static/7fc71abf4225f99ff2b462510ff84e9b/a0209/ttfb-ssg.png 725w\"\n        sizes=\"(max-width: 725px) 100vw, 725px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>더불어 클라이언트의 요청 횟수에 상관없이 빌드 타임에 한 번만 데이터 요청이 이루어지기 때문에 서버 자원 또한 극적으로 절약할 수 있다.</p>\n<h2 id=\"증분-정적-재생성\" style=\"position:relative;\"><a href=\"#%EC%A6%9D%EB%B6%84-%EC%A0%95%EC%A0%81-%EC%9E%AC%EC%83%9D%EC%84%B1\" aria-label=\"증분 정적 재생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>증분 정적 재생성</h2>\n<p>정적 생성 전략을 통해 웹 성능 메트릭 개선과 서버 자원을 절약을 달성할 수 있다. 그러나 한 가지 염두해야 할 것이 있다면,\n빌드 타임에 캐싱된 외부 데이터가 데이터 정합성 측면에서 유효한가를 확인해 봐야 한다.\n개요에서 언급했던 바와 같이, 상품 정보 데이터의 경우 비교적 무거운 정적인 데이터로 간주하여 빌드 타임에\n캐싱하여 정적으로 제공하는 것이 가능하다.</p>\n<p>하지만 구매한 상품 개수, 총 주문 금액을 유저에게 노출시켜 전환율을 높이는 이벤트를 진행한다고 생각해 보자. 상품 개수나, 총 주문 금액과 같은\n데이터는 빌드 타임에 가지고 있을 수 없는 동적인 데이터이다. 하지만 실시간으로 데이터 정합성을 유효하게 제공할 것인가, 혹은 서버 자원 절약하고\n개선된 웹 성능 메트릭을 취할 것인가에 대한 저울질이 가능하다.</p>\n<p>이렇게 비즈니스적인 측면에서 바라보았을때 정적 혹은 동적인 데이터 그 중간 어딘가에 속하는 데이터들은 어떻게 처리할 수 있을까. 바로 <code class=\"language-text\">next.js</code>가 제공하는\n<a href=\"https://vercel.com/docs/concepts/next.js/incremental-static-regeneration\">증분 정적 재생성</a> 전략을 고려해 볼 수 있다.</p>\n<p>증분 정적 재생성은 빌드 타임에 외부 데이터를 패칭해 캐싱하는 정적 생성 전략에서, 일정한 트리거에 의해 데이터 유효성을 검증하고\n이를 최신화하여 정적 생성 전략에서도 데이터 정합성을 일부 챙길 수 있는 전략이다.</p>\n<p>이를 구현하는 방식은 간단하다. <code class=\"language-text\">getStaticProps</code>의 반환 프로퍼티로 초 단위의 <code class=\"language-text\">revalidate</code> 값을 제공하면 된다.\n하지만 단순히 <code class=\"language-text\">revalidate</code>에 설정된 초 단위마다 외부 데이터를 최신화하는 것은 아니기 때문에 트리거에 의해 최신화되는 과정을\n살펴보자.</p>\n<h3 id=\"증분-정적-재생성의-타임라인\" style=\"position:relative;\"><a href=\"#%EC%A6%9D%EB%B6%84-%EC%A0%95%EC%A0%81-%EC%9E%AC%EC%83%9D%EC%84%B1%EC%9D%98-%ED%83%80%EC%9E%84%EB%9D%BC%EC%9D%B8\" aria-label=\"증분 정적 재생성의 타임라인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>증분 정적 재생성의 타임라인</h3>\n<p><code class=\"language-text\">revalidate</code>를 20초로 설정했다고 가정해 보자. 이는 첫 요청이 들어온 이후 20초마다 한번씩 유효성 검사를 진행하고\n데이터 정합성을 확인하여 최신화된 데이터가 담긴 페이지를 반환한다는 것으로 오해할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABA0lEQVR42s1SW2vCMBj1//+IPQgypqDDMd1g1m14mQpO+ySIw3obrU3XbtqLsTlLAm03JuqDwgLn4XxfcnLOl6Rw4pXaVWSMSRzLDwqexCEDi292HAe6oYNSChYyEIvAJET2RM1YGrAdWxz643anw8AP4K7cmPuuD2/txVz0xJ69DoeehiZ5RedDxfOiBUVroEX6HD08TpqockRc0ep4mr2gbalomF2o5oAnCRNBYbm26iJvP+DaquByeoP0KI+cfs9xh/RbQfLsexlXixIuBjlZy85LyMyLuB0r2G62iWDI1X9GoBsK7yuJHLgBh59E/lxzARoNX4pFc/z9KOf6h/9K8BsW21aMjGl9YwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"wrong\"\n        title=\"\"\n        src=\"/static/2216cba94a9164a33086e2c74a9323f9/c1b63/wrong.png\"\n        srcset=\"/static/2216cba94a9164a33086e2c74a9323f9/5a46d/wrong.png 300w,\n/static/2216cba94a9164a33086e2c74a9323f9/0a47e/wrong.png 600w,\n/static/2216cba94a9164a33086e2c74a9323f9/c1b63/wrong.png 1200w,\n/static/2216cba94a9164a33086e2c74a9323f9/1bba3/wrong.png 1433w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>하지만, 정확한 유효성 검사의 흐름은 공식 문서에서 다음과 같이 설명하고 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABK0lEQVR42q2S646CQAyFef/nMxABURAUEblpAInazdekxF3x35I0p1M6p6ftOM/nU67Xq3RdJ23bztY0jRr/6rpWnxzwdrvJ6/WSpc+53+8SBIFEUSSbzUbCMFQk5vu+7Pd7Wa1W4nme5hBLkkQQskhoDkpMlamoqkrVmjJTiWLyvxJSrSxLyfNc7Xg8yvl8/nUGT6eTFEWhZ/K/EjIP1JDIJbsIZlmmPoiyaZpkGAYZx1H9x+OxTIiC3W4n2+1WL8dxrD54OBzmRdGyLXCp9ZmQQRuhIUsgjlGEDkAKoJquGA2L/SAkAbOZWZs2xzRNNQ4ZPkR936vR+sdSULNer9Vc19VngzIQxfwH37uwJ3a5XMSEzQoJYsyF6syGOEOn4Lv9jb0/ckf++fsBVkZIx2pZbzoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"isr-flow\"\n        title=\"\"\n        src=\"/static/bf23846d96f83f4ba7e4723f33816ad8/c1b63/isr-flow.png\"\n        srcset=\"/static/bf23846d96f83f4ba7e4723f33816ad8/5a46d/isr-flow.png 300w,\n/static/bf23846d96f83f4ba7e4723f33816ad8/0a47e/isr-flow.png 600w,\n/static/bf23846d96f83f4ba7e4723f33816ad8/c1b63/isr-flow.png 1200w,\n/static/bf23846d96f83f4ba7e4723f33816ad8/85e74/isr-flow.png 1436w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><code class=\"language-text\">revalidate</code>가 20초로 설정된 페이지는 빌드 타임에 정적 생성되었다. 해당 페이지 요청(1)이 이루어졌다면,\n0초를 기준으로 빌드 시점에 캐싱되어 있는 페이지가 반환된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6UlEQVR42s2RUUsCQRSF/f//ITIiMFEhwZLqNVpNarUCDSMiis1dZkkdHWd29msbTbSXHjTowoFzZuBw7rk5tjy5NE1ZxcaGW08opUQIMUcs0Fq7j5/Jf8PaymqqGH2MlkYbr5wkCffigVZ8Ryu6pTHw8YIbmlGbZth23AuuHW9kb5cLfRV18EKfTtjFJna9w4uJTyk+pSLOOHipstsvURzUKb6fsPdUId8vUwiOKbzV2Okdkn8sO77/ekT1+RyzqMoZfrnPsrW/x8wMciiXWk0UajzN+sBBDscYpec6C2a0wVr7R1f+94afT6NXkZskfW8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"isr-step-1\"\n        title=\"\"\n        src=\"/static/b10448a487895f3798cd16f6763ef007/c1b63/step-1.png\"\n        srcset=\"/static/b10448a487895f3798cd16f6763ef007/5a46d/step-1.png 300w,\n/static/b10448a487895f3798cd16f6763ef007/0a47e/step-1.png 600w,\n/static/b10448a487895f3798cd16f6763ef007/c1b63/step-1.png 1200w,\n/static/b10448a487895f3798cd16f6763ef007/e515d/step-1.png 1430w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>가령 이후 다른 유저가 20초 이내 같은 페이지를 요청(2)했다면, 이것 또한 기존 캐싱되어 있는 페이지가 반환된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVR42q2S7UsCQRDG7///I4IKghQrKOkNhNReFXv5kB8iEKLs1NXTo927c3d/3Z1xckIQebPMMs/M8PDMMA4Fm5N81trMCyFctXWIHfklEUIwnozxPA+tNauq/+I5hUEQIFyBL2Z4gwlqJjHa/H/kRNWj6FJ37zjvNaj3b2l8trgadbgcduK4TTPBcZzkUuy2uBb3NEdtHobPGGPyO7yRTxxMaxxNL9h9q7L5skdlcEbFPWX7dZ+tGJf7J5Q+jtnoltJcOY533g+p9mrMo/mSMBkvVGEmW0ca5asMRyoilMu68mXas1j2ot8am1dof15hZ1PEDf56h+sQfgORZ1bJmpS62QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"isr-step-2\"\n        title=\"\"\n        src=\"/static/e924db212802ad75c4e7f965fb35ea20/c1b63/step-2.png\"\n        srcset=\"/static/e924db212802ad75c4e7f965fb35ea20/5a46d/step-2.png 300w,\n/static/e924db212802ad75c4e7f965fb35ea20/0a47e/step-2.png 600w,\n/static/e924db212802ad75c4e7f965fb35ea20/c1b63/step-2.png 1200w,\n/static/e924db212802ad75c4e7f965fb35ea20/1bba3/step-2.png 1433w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>드디어 우리가 설정한 20초가 지난 시점에 새로운 페이지 요청(3)이 들어왔다. 해당 페이지에 <code class=\"language-text\">revalidate</code>로 설정한\n20초가 지났기 때문에 캐싱되어 있는 페이지에 대한 유효성 검사를 진행하고, 최신화된 페이지를 반환할 것이라\n기대하지만 그렇지 않다. 마찬가지로 신선하지 않은 캐싱된 페이지를 반환받는다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAklEQVR42q1STUvDQBTs//8NHloEsWILLWgPLQgaI9KQtgexoBWVol3z2WA3+za7GZM0VHISYXcZeI+BYWZ4LRh+rTzPzQoad8g5RxiGiKII8TYGSQlZgIiQihRKKZQp/kIjshACIfPxHST4WjN4NdKEQ2f6/5FLF4vgETdsismbBZu5GL9c4z6Y486fwdo4sD4d2J4L23frfbrnPAdz76HSaHR4y2fobycYxFc4eR+is+rhjI0qdFZ9tJ/O0d1c4vTjAkfLLtrPvWo+Xg8wfB1DkvwV1EqDUnGwnVEGnuwOO3EC7Qq+rKpAyWUi2+9FI0oqaK2bDvP6GzsbU/do/A5/AEBiVY6fsKEWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"isr-step-3\"\n        title=\"\"\n        src=\"/static/eebdbd40e5a2b218404d6e20b6767d8a/c1b63/step-3.png\"\n        srcset=\"/static/eebdbd40e5a2b218404d6e20b6767d8a/5a46d/step-3.png 300w,\n/static/eebdbd40e5a2b218404d6e20b6767d8a/0a47e/step-3.png 600w,\n/static/eebdbd40e5a2b218404d6e20b6767d8a/c1b63/step-3.png 1200w,\n/static/eebdbd40e5a2b218404d6e20b6767d8a/b6c94/step-3.png 1429w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>개인적으로 이 단계에서 예상과 달라 혼란이 있다. 그렇다면, 어느 시점에 새롭게 유효성 검사가 진행될까.\n바로 20초가 지나서 전달된 새로운 요청(3)이 유효성을 재검사의 트리거가 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABl0lEQVR42qVSTU+DQBDl/59NTUw9GKMHa4w3b969qalGG2hLoXwsn5blayk8mWmatvEjMS4MgdmZt+8xT2uaBlVVoa5rjq7r8J+lEViapvB9H1EUIUkSCCEQBAHSJAUd+CdAeiil4IsNoDE14PkeTHOOvMiZPUW5p6KsSlR1/61qDtWoHSBL7O97+YBTcYMz/xbDxQjH+iWGyxGG9ggD/YLjxLriOJqcY2BcYGj1e4tLXM/u0DbrHcN23cKRPlwVwFMhjNjEePkGtxZwqwDvwsCrO8Gy8GDnHp4XL9CjOb/PVzYW8bLH2AMkhl17OIxVukIhC1R5ibqsORf6AVzbQaOaTc9600Mqt8PUtgAdx+bi5iiEzCWSOEEmM6QfKWbzGabTKR6fnjAejyECgbZtD5yhfTcpGpLjOJBSoigKeJ6HOI7hui50XWcnkDOyLOM8OYRy6172t4B0ItmFisMwRJ7nXEyHWJbFQGVZ8vTJGUSA9qlP+81TVEgNBEhsSa5pmszYtm0GJslffPjT2v83xJjkE8hvZv8ECKpLdmM4B80AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"isr-step-4\"\n        title=\"\"\n        src=\"/static/f1b70e24e4931788a802afc692f1cf8f/c1b63/step-4.png\"\n        srcset=\"/static/f1b70e24e4931788a802afc692f1cf8f/5a46d/step-4.png 300w,\n/static/f1b70e24e4931788a802afc692f1cf8f/0a47e/step-4.png 600w,\n/static/f1b70e24e4931788a802afc692f1cf8f/c1b63/step-4.png 1200w,\n/static/f1b70e24e4931788a802afc692f1cf8f/4c5bd/step-4.png 1435w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>20초가 지난 시점에서 새로운 요청(3)이 들어오면, 기존에 캐싱되어 있던 페이지를 다시 최신화한다.\n이때 재생성이 성공한다면, 기존의 캐싱된 페이지는 무효화되고 재생성된 페이지가 새롭게 캐싱된다.\n그러나 모종의 이유로 재생성에 실패한다면, 기존에 캐싱된 페이지가 유지된다.</p>\n<p><em>이 시점을 왜 재생성의 트리거로 설정했을까라는 생각을 오해했는데, 20초마다 조건없이 재생성 하기보다는,\n20초 이후 들어온 새로운 요청에 대해 빠르게 페이지를 반환해 주고, 최신화된 데이터에 대한 수요를 확인하여\n재생성이 이루어지도록 하는 것이 훨씬 경제적이지 않을까 판단됩니다.</em></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKElEQVR42sVSXUvDMBTd//8RPqiI0KGFCZuKinNzok6dD7IHHX5s7dqafo20TZvk2KajOlBBKJjLyc25CZdzb24DNa9GsUkpK9SSsFaFlFIQl8D1XHi+B8YYWJoqHycxOOcrFfyEKmFBkiQBsQgWJIQ1ncNeIg4jiEz8veRCxb07Rnd+iaOXHvr2EAeTLi7e73Du3ODMvFIo4n1nWPGBc4uefY2R8wApxGoPB9EIenCMPf8U268tbE507DiHaFr72HjSsf64i6bZgWa0sTbWVEwzOtiatdB+PgFP+WdCwQVYzMrMsuQB8RHRSIVYlIDRRN0ViEIKzrKS58J4muUK5apCuTQhhfogwzTwNpuC5Oc0/6Svb76zX8cmCAL4vo8wDJUvevxvc/gB7plTy3Ryz0IAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"isr-step-5\"\n        title=\"\"\n        src=\"/static/fcce8f8d1e4728edca4cf3b3ecef0d4b/c1b63/step-5.png\"\n        srcset=\"/static/fcce8f8d1e4728edca4cf3b3ecef0d4b/5a46d/step-5.png 300w,\n/static/fcce8f8d1e4728edca4cf3b3ecef0d4b/0a47e/step-5.png 600w,\n/static/fcce8f8d1e4728edca4cf3b3ecef0d4b/c1b63/step-5.png 1200w,\n/static/fcce8f8d1e4728edca4cf3b3ecef0d4b/1bba3/step-5.png 1433w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>재생성이 완료된 이후 시점에 새로운 요청(4)이 들어온다면, 최신화된 페이지를 반환받게 된다.</p>\n<h3 id=\"제품에-적용하기-앞서\" style=\"position:relative;\"><a href=\"#%EC%A0%9C%ED%92%88%EC%97%90-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0-%EC%95%9E%EC%84%9C\" aria-label=\"제품에 적용하기 앞서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>제품에 적용하기 앞서</h3>\n<p>사실 여러 성질을 가진 데이터들을 요구하는 제품 상세 페이지에 증분 정적 재생성 전략을 취하는 것은 생각보다 불안해\n재검증되는 타임라인을 그려보기도 하고, 생각보다 비슷한 우려에 대해 <a href=\"https://github.com/vercel/next.js/discussions?discussions_q=ecommerce\">논의한 이야기</a>들도 읽어보며 참고했다.</p>\n<p>웹 성능 메트릭을 조금 양보하더라도 서버사이드 랜더링 전략을 취해 모든 요청에 대해 데이터가 패칭되도록 해야 할까라는 생각도 했지만,\n정적 생성 전략의 응답 속도를 경험해 본다면 포기하기 힘들다.</p>\n<p>결과적으로 정적인 상품 정보와 같이 무겁고 메타데이터에 활용도가 높은 데이터들은 증분 정적 재생성되도록 캐싱하여\n사용하고, 메타데이터와 무관하며 실시간으로 데이터 정합성 판단이 필요한 남은 수량, 가격 변동과 같은 데이터들은 클라이언트에서\n요청을 분리하여 페이지를 완성하는 전략으로 작업을 진행했다.</p>\n<h2 id=\"마치면서\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B4%EC%84%9C\" aria-label=\"마치면서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치면서</h2>\n<p><code class=\"language-text\">stale-while-revalidate</code> 전략을 통해 클라이언트에서 서버 데이터를 캐싱하고 관리해 주는 <code class=\"language-text\">react-query</code>나,\n<code class=\"language-text\">swr</code>과 같은 도구들이 자주 등장한다. 여기서 사용되는 전략 또한 동일한 타임 라인을 가지고 있기 때문에 한번 사용해 보면\n좋을 것 같다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1016px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSElEQVR42k1Ru04EMQxMnHey2c3esnRIICREcVBBcyWi4/+/Z7Cz5LhiNI7tGTuJWpYFKSXUWlFKwbZtPZb8uq7IOXc+nU434PNfTmq3UCJeuWGTYmtXYzFs3DDPC+pckUvug1OKSHnCVBtKPhZZuD4zS6xCCNj3HfOysrDBWgtjTDeVhok5lghtNZRSB2yCrzus8yiVB7J2Ym3kgUoaiAhPu8Pzve0Cx6aRB2my0G4CucxcQKF2GOGeY9jYmXyGDxFKa4XL64Lz+R0/Hzta5k20QYxBiiBjQdZDazoGkOEFbF9C8/ABy7fy3h8bXl4Kvj8f8fXWkJzqghh5MhsaFhpDnNMHJGeoP4sm6sYC59y/YfAW54eEu9lfryxvO56ji9loYJjc5szYUAqBtzH8DiEm/pSjID8qTfJJchYesWwjsfCIpVdu9QvjEbAqPxQsHwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"web-vital-score\"\n        title=\"\"\n        src=\"/static/23eff5fbf5f5c901814a7b14b9a3daa1/f4281/web-vital-score.png\"\n        srcset=\"/static/23eff5fbf5f5c901814a7b14b9a3daa1/5a46d/web-vital-score.png 300w,\n/static/23eff5fbf5f5c901814a7b14b9a3daa1/0a47e/web-vital-score.png 600w,\n/static/23eff5fbf5f5c901814a7b14b9a3daa1/f4281/web-vital-score.png 1016w\"\n        sizes=\"(max-width: 1016px) 100vw, 1016px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>","frontmatter":{"title":"Incremental Static Regeneration 타임라인 이해하기","description":"증분 정적 생성의 타임라인을 살펴봅니다.","date":"2022.01.08"}}},"pageContext":{"slug":"/nextjs/next-isr/","previous":{"fields":{"slug":"/nextjs/cra-to-next/"},"frontmatter":{"title":"CRA 프로젝트를 next.js로 전환해보자"}},"next":{"fields":{"slug":"/javascript/javascript-prototype/"},"frontmatter":{"title":"자바스크립트 프로토타입 톺아보기"}}}},"staticQueryHashes":["3665086019"],"slicesMap":{}}